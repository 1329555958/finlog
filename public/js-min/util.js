/*! finlog - v0.2.0 - 2017-03-09 Copyright (c) 2017 vfinance; Licensed MIT */
define("util",["base"],function(){return function(t){function mark_reg(){return/<mark>(.+?)<\/mark>/g}function addMark(src,mark){var exps=[];return _.each(mark,function(m){var matchs=m.match(mark_reg());_.each(matchs,function(match){exps.push(mark_reg().exec(match)[1])})}),exps=_.sortBy(exps,function(e){return 0-e.length}),_.each(exps,function(e){src=src.replace(new RegExp("([^>]|)"+e,"g"),function(match,$1,index,str){return indexIsInMark(index,str)?$1+e:$1+"<mark>"+e+"</mark>"})}),src}function indexIsInMark(index,str){if(0>index||str.length-index<5)return!1;var after=str.substring(index,index+6),gtIndex=after.indexOf(">");if(0>gtIndex)return!1;if(5>index+gtIndex)return!1;var mark=str.substring(index+gtIndex-5,index+gtIndex);if("mark"===mark.replace(/\W/g,""))return!0;var before=str.substring(Math.min(index-5,0),index),ltIndex=before.indexOf("<");if(0>ltIndex)return!1;var mark=str.substring(ltIndex,ltIndex+6);return"mark"===mark.replace(/\W/g,"")?!0:!1}t.makeEsQ=function(obj,op){op=op||" AND ";var q=[];return _.each(obj,function(val,key){val&&q.push(key+":"+val+"*")}),q.join(op)},t.makeUniqueId=function(prefix){return prefix+"_"+_.now()+"_"+_.uniqueId()},t.calcTime=function(timeSlot,startTime){var endTime=new Date,calc=-1;switch(startTime&&(endTime=startTime,calc=1),timeSlot.unit){case"MIN":return dateUtil.addInteger(endTime,dateUtil.calendar.minute,((timeSlot.timeSlot||timeSlot.value)-0)*calc);case"HOUR":return dateUtil.addInteger(endTime,dateUtil.calendar.hour,((timeSlot.timeSlot||timeSlot.value)-0)*calc);case"DAY":return dateUtil.addInteger(endTime,dateUtil.calendar.day,((timeSlot.timeSlot||timeSlot.value)-0)*calc)}},t.requestFullScreen=function(ele,exitCb){function cb(){exitCb&&exitCb(),document.removeEventListener("fullscreenchange",cb),document.removeEventListener("webkitfullscreenchange",cb),document.removeEventListener("mozfullscreenchange",cb),document.removeEventListener("msfullscreenchange",cb)}ele.requestFullscreen?ele.requestFullscreen():ele.mozRequestFullScreen?ele.mozRequestFullScreen():ele.webkitRequestFullScreen&&ele.webkitRequestFullScreen(),setTimeout(function(){document.addEventListener("fullscreenchange",cb),document.addEventListener("webkitfullscreenchange",cb),document.addEventListener("mozfullscreenchange",cb),document.addEventListener("msfullscreenchange",cb)},300)},t.exitFullscreen=function(){var de=document;de.exitFullscreen?de.exitFullscreen():de.mozCancelFullScreen?de.mozCancelFullScreen():de.webkitCancelFullScreen&&de.webkitCancelFullScreen()},t.replaceHighlightField=function(data){var hits=data;if(hits)return _.each(hits,function(h){h.highlight&&(_.each(h.highlight,function(val,key){h[key]?h[key]=addMark(h[key],val):h._source[key]&&(h._source[key]=addMark(h._source[key],val))}),delete h.highlight)}),data}}});