/*! finlog - v0.2.0 - 2017-03-09 Copyright (c) 2017 vfinance; Licensed MIT */
function ScrollBottom($timeout,callback,threshold){function hasToBottom(){return $body.height()-Math.max($body.scrollTop(),document.documentElement.scrollTop)<=$window.height()+threshold}function init(){$body||($body=$("body")),$window||($window=$(window)),$window.scroll(handle)}function handle(){if(hasToBottom()){for(;queue.length;)clearTimeout(queue.shift());queue.push(setTimeout(callback,300))}}threshold=threshold||100,callback=callback||$.noop;var $body=null,$window=null,queue=[];init()}var EVENT={TAB_SHOWN:{emit:"TAB_SHOWN",broadcast:"Tab_Shown"},CONDITION_AREA:{emit:"SHOW_CONDITION_AREA",broadcast:"Show_Condition_Area"},CONDITION_CHANGE:{emit:"CONDITION_CHANGE",broadcast:"Condition_Change"},CHANGE_CONDITION:{emit:"CHANGE_CONDITION",broadcast:"Change_Condition"},CHANGE_CONDITION_DISPLAY:{emit:"CHANGE_CONDITION_DISPLAY",broadcast:"Change_Condition_Display"},SCROLL_BOTTOM:{emit:"SCROLL_BOTTOM",broadcast:"Scroll_Bottom"}},STORE={CONDITION:"condition_store",CONDITION_DISPLAY:"condition_display_store",TIME_SLOT:"time_slot",REDIRECT_HREF:"redirect_href"};!function(){var href=JSON.parse(localStorage.getItem(STORE.REDIRECT_HREF));href&&(localStorage.setItem(STORE.REDIRECT_HREF,JSON.stringify(null)),window.location.href=href)}();var TIMESLOT_IS_CUSTOM=!1;define("app",["util","base"],function(util){util(_);var app=window.APP=angular.module("app",["ngExtend","ui.router","ui.ace","ngSanitize"]);app.getCurrentTimeslot=function(){return angular.store(STORE.CONDITION)},app.getCurrentTimeRange=function(_timeslot){var timeRange=null;if(TIMESLOT_IS_CUSTOM)timeRange=_.chain(_timeslot).pick("startTime","endTime").each(function(val,key,t){t[key]=dateUtil.parse(val).getTime()}).value();else{var startTime=_.calcTime(_timeslot),endTime=new Date;timeRange={startTime:startTime.getTime(),endTime:endTime.getTime()}}return console.debug("timerange",timeRange),timeRange},app.dialog=function(html,close_callback){function hide(){$.mask.hide(),$(document).unbind("keydown.mask"),wrap.unbind("click.mask"),close_callback&&close_callback()}var wrap=$.mask({maskHtml:html});setTimeout(function(){wrap.one("click.mask",function(){hide()}),$(document).bind("keydown.mask",function(event){var key=event.keyCode;27===key&&hide()})},500)};var infodlg=null,infomsg=null;return app.info=function(msg,timeout){timeout=void 0===timeout?0:timeout,infodlg||(infodlg=$("#infodialog"),infomsg=infodlg.find("#infomsg")),infomsg.text(msg),infodlg.show().find(".box").hide().slideDown(600),timeout>0&&setTimeout(function(){app.info.hide()},timeout)},window.alert=app.info,window.infoDlgHide=app.info.hide=function(){infodlg.find(".box").slideUp(600,function(){infodlg.hide()})},app.constant("VIEWS_BASE_PATH","/public/views"),app.config(function($stateProvider,VIEWS_BASE_PATH,$controllerProvider,$filterProvider,$requireProvider,$urlRouterProvider,$provide){function resolve($q,url,deps){var def=$q.defer();return require(deps,function(){def.resolve()},function(){def.resolve(),console.warn(url+"没有对应的js依赖!")}),def.promise}function addSuffix(url){if(-1!==url.indexOf("."))return url;var index=url.indexOf("?");return-1===index?url+suffix:url.substring(0,index)+suffix+url.substring(index)}function getDeps(url){var dep=url;return dep&&(0===dep.indexOf("/")&&(dep=dep.substring(1)),dep=dep.split(/[.\?]/)[0]),[dep]}app.register={controller:$controllerProvider.register,filter:$filterProvider.register,factory:$provide.factory};var suffix=".html";$urlRouterProvider.when(/^\/?$/,"/logqry"),$stateProvider.state("def",{url:"{url:[^@]*}",templateUrl:function($stateParams){var url=VIEWS_BASE_PATH+$stateParams.url;return addSuffix(url)},resolve:{require:function($q,$stateParams){return resolve($q,$stateParams.url,getDeps($stateParams.url))}}})}),app}),require(["condition","app"],function(condition,app){app.controller("conditionController",condition)}),define("init",["app"],function(app){app.controller("rootController",function($rootScope,$timeout){function getCookie(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");return(arr=document.cookie.match(reg))?unescape(arr[2]):null}var condition={};$rootScope.JSONStringify=JSON.stringify,$rootScope.$on(EVENT.TAB_SHOWN.emit,function(event,data){$rootScope.$broadcast(EVENT.TAB_SHOWN.broadcast,data)}),$rootScope.$on(EVENT.CONDITION_AREA.emit,function(event,data){$rootScope.$broadcast(EVENT.CONDITION_AREA.broadcast,data)}),$rootScope.$on(EVENT.CONDITION_CHANGE.emit,function(event,data){condition=data,$rootScope.$broadcast(EVENT.CONDITION_CHANGE.broadcast,data)}),$rootScope.$on(EVENT.CHANGE_CONDITION.emit,function(event,data){return angular.isString(data)?void $rootScope.$broadcast(data,condition):void $rootScope.$broadcast(EVENT.CHANGE_CONDITION.broadcast,data)}),$rootScope.escapeHtml=function(str){var escape=str;return angular.isString(str)&&(escape=_.escape(str),escape=escape.replace(/&lt;mark&gt;/g,"<mark>").replace(/&lt;\/mark&gt;/g,"</mark>").replace(/(&quot;|\\")/g,"").replace(/(\\n|\n)/g,"<br/>").replace(/(\\t|\t)/g,"&nbsp;&nbsp;&nbsp;&nbsp;")),escape},$rootScope.user=JSON.parse(getCookie("user")),ScrollBottom($timeout,function(){$rootScope.$broadcast(EVENT.SCROLL_BOTTOM.broadcast,null)}),$(document).delegate('a[data-toggle="tab"]',"shown.bs.tab",function(e){$rootScope.$emit(EVENT.TAB_SHOWN.emit,e),setTimeout(function(){$(window).resize()},200)})})}),require(["init"],function(){angular.element(document).ready(function(){$(document).delegate("a","click",function(event){var href=$(this).attr("href");"#"===href&&event.preventDefault()}),angular.bootstrap(document,["app"]),window.__karma__&&(angular.module("app").provider({$rootElement:function(){this.$get=function(){return angular.element("<div ng-app></div>")}}}),window.my$injector=angular.injector(["app"]))})});